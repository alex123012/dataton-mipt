---
project: dataton-mipt
configVersion: 1
---
image: app
from: python:3.11
docker:
  WORKDIR: /app
  ENV:
    PYTHONPATH: /app
    PATH: "/app/.venv/bin:$PATH"
git:
  - add: /
    to: /app
    includePaths:
      - model
      - notificator
      - predictor
      - static
      - templates
      - video_parser
      - app.py
      - poetry.lock
      - pyproject.toml
      - settings.py
      - tasks.py
    stageDependencies:
      install:
        - poetry.lock
        - pyproject.toml
      setup:
        - '**/*'
shell:
  install:
    - pip install poetry
    - cd /app && poetry config virtualenvs.create true
    - cd /app && poetry config virtualenvs.in-project true
    - cd /app && poetry install --only main
    - cd /app && poetry cache clear pypi --all